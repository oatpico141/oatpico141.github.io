<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1>üè• ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</h1>
        </div>
        <ul class="nav-menu">
            <li><a href="index.html" class="active">üìä Dashboard</a></li>
            <li><a href="patients.html">üë• ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</a></li>
            <li><a href="appointments.html">üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</a></li>
            <li><a href="records.html">üìã ‡πÄ‡∏ß‡∏ä‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</a></li>
            <li><a href="billing.html">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô/‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="page-header">
            <h2>Dashboard</h2>
            <p class="subtitle">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card stat-patients">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <h3 id="totalPatients">0</h3>
                    <p>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
            </div>

            <div class="stat-card stat-appointments">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-info">
                    <h3 id="todayAppointments">0</h3>
                    <p>‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                </div>
            </div>

            <div class="stat-card stat-queue">
                <div class="stat-icon">‚è∞</div>
                <div class="stat-info">
                    <h3 id="waitingQueue">0</h3>
                    <p>‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå</p>
                </div>
            </div>

            <div class="stat-card stat-revenue">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3 id="todayRevenue">0</h3>
                    <p>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏ö‡∏≤‡∏ó)</p>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <h3>üîî ‡∏Ñ‡∏¥‡∏ß‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                </div>
                <div class="card-body">
                    <div id="todayQueueList" class="queue-list">
                        <p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>üìÖ ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á</h3>
                </div>
                <div class="card-body">
                    <div id="upcomingAppointments" class="appointment-list">
                        <p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
            </div>
            <div class="card-body">
                <div class="monthly-stats">
                    <div class="monthly-stat-item">
                        <span class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡∏°‡πà:</span>
                        <span class="value" id="monthlyNewPatients">0</span>
                    </div>
                    <div class="monthly-stat-item">
                        <span class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:</span>
                        <span class="value" id="monthlyAppointments">0</span>
                    </div>
                    <div class="monthly-stat-item">
                        <span class="label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°:</span>
                        <span class="value" id="monthlyRevenue">0</span>
                        <span> ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Load dashboard data
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        function loadDashboard() {
            const patients = JSON.parse(localStorage.getItem('patients')) || [];
            const appointments = JSON.parse(localStorage.getItem('appointments')) || [];
            const billings = JSON.parse(localStorage.getItem('billings')) || [];

            // Total patients
            document.getElementById('totalPatients').textContent = patients.length;

            // Today's date
            const today = new Date().toISOString().split('T')[0];

            // Today's appointments
            const todayAppts = appointments.filter(apt => apt.date === today);
            document.getElementById('todayAppointments').textContent = todayAppts.length;

            // Waiting queue
            const waitingQueue = todayAppts.filter(apt => apt.status === '‡∏£‡∏≠‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå');
            document.getElementById('waitingQueue').textContent = waitingQueue.length;

            // Today's revenue
            const todayBillings = billings.filter(bill => bill.date === today);
            const todayRevenue = todayBillings.reduce((sum, bill) => sum + parseFloat(bill.total || 0), 0);
            document.getElementById('todayRevenue').textContent = todayRevenue.toLocaleString();

            // Display today's queue
            displayTodayQueue(waitingQueue);

            // Display upcoming appointments
            displayUpcomingAppointments(appointments);

            // Monthly stats
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyPatients = patients.filter(p => p.registeredDate && p.registeredDate.startsWith(currentMonth));
            const monthlyAppts = appointments.filter(a => a.date && a.date.startsWith(currentMonth));
            const monthlyBills = billings.filter(b => b.date && b.date.startsWith(currentMonth));
            const monthlyRev = monthlyBills.reduce((sum, bill) => sum + parseFloat(bill.total || 0), 0);

            document.getElementById('monthlyNewPatients').textContent = monthlyPatients.length;
            document.getElementById('monthlyAppointments').textContent = monthlyAppts.length;
            document.getElementById('monthlyRevenue').textContent = monthlyRev.toLocaleString();
        }

        function displayTodayQueue(queue) {
            const container = document.getElementById('todayQueueList');

            if (queue.length === 0) {
                container.innerHTML = '<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            container.innerHTML = queue.map(apt => `
                <div class="queue-item">
                    <div class="queue-number">Q${apt.queueNumber || '-'}</div>
                    <div class="queue-info">
                        <strong>${apt.patientName}</strong>
                        <span class="time">${apt.time || '-'}</span>
                    </div>
                </div>
            `).join('');
        }

        function displayUpcomingAppointments(appointments) {
            const container = document.getElementById('upcomingAppointments');
            const today = new Date().toISOString().split('T')[0];

            const upcoming = appointments
                .filter(apt => apt.date > today)
                .sort((a, b) => a.date.localeCompare(b.date))
                .slice(0, 5);

            if (upcoming.length === 0) {
                container.innerHTML = '<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>';
                return;
            }

            container.innerHTML = upcoming.map(apt => `
                <div class="appointment-item">
                    <div class="appointment-date">${formatDate(apt.date)}</div>
                    <div class="appointment-info">
                        <strong>${apt.patientName}</strong>
                        <span class="time">${apt.time || '-'}</span>
                    </div>
                </div>
            `).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.',
                              '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            return `${date.getDate()} ${thaiMonths[date.getMonth()]}`;
        }
    </script>
</body>
</html>
